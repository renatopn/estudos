<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶∏‚Äç‚ôÇÔ∏è Tabuada Aranha üï∏Ô∏è - O Jogo Cont√≠nuo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üï∑Ô∏è</text></svg>">
    
    <style>
        /* --- Vari√°veis e Estilos Globais (Tema Homem-Aranha) --- */
        :root {
            --vermelho-aranha: #e62020;
            --azul-aranha: #153c9e;
            --amarelo-alerta: #ffeb3b;
            --branco-teia: #ffffff;
            --preto-sombra: #222222;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--preto-sombra);
            background-image: radial-gradient(circle, var(--azul-aranha) 0%, var(--preto-sombra) 100%);
            color: var(--branco-teia);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        #container-principal {
            background-color: rgba(25, 25, 25, 0.9);
            border: 5px solid var(--vermelho-aranha);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 40px var(--vermelho-aranha);
            max-width: 90%;
            width: 450px;
            transition: width 0.5s;
        }
        
        #container-principal.bonus-mode {
            width: 700px;
        }

        h1 {
            color: var(--vermelho-aranha);
            text-shadow: 2px 2px 4px var(--azul-aranha);
            margin-bottom: 20px;
            font-size: 2em;
        }

        /* --- Estilos do Jogo Principal (Tabuada) --- */
        
        #jogo-tabuada {
            display: block;
        }
        
        #placar {
            display: flex;
            justify-content: space-around;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }

        #placar .contador-bonus {
            color: var(--amarelo-alerta);
        }

        #pergunta-box {
            background-color: var(--azul-aranha);
            border: 3px solid var(--branco-teia);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 0 10px var(--amarelo-alerta);
        }

        #pergunta {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--branco-teia);
            margin: 0;
        }

        #opcoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .opcao-btn {
            background-color: var(--vermelho-aranha);
            color: var(--branco-teia);
            border: none;
            padding: 15px 10px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--preto-sombra);
        }

        .opcao-btn:hover:not(:disabled) {
            background-color: #ff3333;
            transform: translateY(-2px);
        }

        .opcao-btn:active:not(:disabled) {
            box-shadow: 0 2px var(--preto-sombra);
            transform: translateY(2px);
        }

        #feedback {
            min-height: 50px;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        #iniciar-reiniciar {
            background-color: var(--amarelo-alerta);
            color: var(--preto-sombra);
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 4px var(--preto-sombra);
            margin-top: 10px;
        }

        #iniciar-reiniciar:hover {
            background-color: #ffd700;
        }

        /* Estilos de Feedback */
        .sucesso {
            color: var(--amarelo-alerta);
            animation: pulsar 0.5s 2;
        }

        .erro {
            color: var(--vermelho-aranha);
            animation: shake 0.5s;
        }

        @keyframes pulsar {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        /* --- Estilos do Jogo B√¥nus da Mem√≥ria --- */

        #jogo-bonus {
            display: none;
        }
        
        #memoria-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .card {
            background-color: var(--azul-aranha);
            height: 100px;
            border: 3px solid var(--vermelho-aranha);
            border-radius: 10px;
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 5px var(--preto-sombra);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flip .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.4em;
            font-weight: bold;
            border-radius: 8px;
            padding: 5px;
            box-sizing: border-box;
        }
        
        .card-back {
            background: repeating-linear-gradient(45deg, var(--vermelho-aranha), var(--vermelho-aranha) 10px, var(--azul-aranha) 10px, var(--azul-aranha) 20px);
            color: var(--branco-teia);
            font-size: 3em;
        }
        
        .card-front {
            background-color: var(--branco-teia);
            color: var(--preto-sombra);
            transform: rotateY(180deg);
        }
        
        .card.matched .card-inner {
            opacity: 0.5;
            transition: opacity 1.5s;
        }
    </style>
</head>
<body>

    <div id="container-principal">
        <h1>üï∏Ô∏è Miss√£o Tabuada Aranha üï∑Ô∏è</h1>

        <div id="jogo-tabuada">
            <div id="placar">
                <span>‚≠ê Acertos Total: <span id="pontuacao">0</span></span>
                <span class="contador-bonus">üéØ Pr√≥ximo B√¥nus: <span id="acertos-rodada">0</span>/10</span>
                <span>‚è±Ô∏è Tempo: <span id="tempo">7.0</span>s</span>
            </div>

            <div id="pergunta-box">
                <p id="pergunta">Clique em Iniciar Miss√£o para come√ßar!</p>
            </div>

            <div id="opcoes">
                </div>

            <div id="feedback">
                </div>

            <button id="iniciar-reiniciar" onclick="iniciarJogo()">Iniciar Miss√£o</button>
        </div>

        <div id="jogo-bonus">
            <h2>üèÜ Jogo B√¥nus: Desafio da Mem√≥ria! üß†</h2>
            <p>Combine a opera√ß√£o com o resultado. Sem tempo!</p>
            
            <div id="memoria-placar">
                 <span>‚úÖ Pares Encontrados: <span id="pares-encontrados">0</span>/8</span>
            </div>

            <div id="memoria-grid">
                </div>
            
            <button id="continuar-tabuada" onclick="finalizarMemoria(false)">Voltar para a Tabuada</button>
        </div>

    </div>

    <script>
        // --- Vari√°veis Globais do Jogo Principal ---
        const ACERTOS_PARA_BONUS = 10;
        const TEMPO_MAXIMO_TABUADA = 7.0; // Aumento para 7 segundos
        const MAX_NUM = 9;
        const MIN_NUM = 1;
        let pontuacao = 0; // Acertos totais (n√£o reseta)
        let acertosRodada = 0; // Contador para o b√¥nus (reseta ap√≥s o b√¥nus)
        let tempoAtual = TEMPO_MAXIMO_TABUADA;
        let intervaloTempoTabuada;
        let respostaCorreta;
        let jogoAtivo = false;
        
        // --- Vari√°veis Globais do Jogo B√¥nus ---
        let cartasViradas = [];
        let paresEncontrados = 0;
        let bloqueioCliques = false; // Para evitar cliques durante a virada/match
        
        // --- Arrays de Mensagens ---
        const MENSAGENS_SUCESSO = [
            "ü•≥ TEIAAAAAAAAA! Voc√™ acertou!", "‚≠ê Parab√©ns, G√™nio da Teia!", 
            "üöÄ Que velocidade, Vingador!", "‚úÖ Uau! Reflexo de Aranha!", 
            "üíØ Miss√£o cumprida com sucesso!"
        ];
        const MENSAGENS_ERRO = [
            "‚ùå Erro! N√£o desista, her√≥i! A resposta era: ", 
            "üòÖ Quase! Tente de novo! A resposta correta era: ", 
            "üí° O Homem-Aranha persiste! A resposta certa era: ", 
            "üí™ For√ßa! Na pr√≥xima voc√™ pega! O resultado era: "
        ];

        // --- Elementos do DOM ---
        const elContainerPrincipal = document.getElementById('container-principal');
        const elJogoTabuada = document.getElementById('jogo-tabuada');
        const elJogoBonus = document.getElementById('jogo-bonus');
        const elPontuacao = document.getElementById('pontuacao');
        const elAcertosRodada = document.getElementById('acertos-rodada');
        const elTempo = document.getElementById('tempo');
        const elPergunta = document.getElementById('pergunta');
        const elOpcoes = document.getElementById('opcoes');
        const elFeedback = document.getElementById('feedback');
        const elBotaoIniciar = document.getElementById('iniciar-reiniciar');
        
        // DOM B√¥nus
        const elParesEncontrados = document.getElementById('pares-encontrados');
        const elMemoriaGrid = document.getElementById('memoria-grid');


        // --- Fun√ß√µes Auxiliares ---

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function exibirFeedback(mensagem, tipo) {
            elFeedback.textContent = mensagem;
            elFeedback.className = tipo;
        }

        function misturarArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- L√≥gica Principal do Jogo (Tabuada) ---

        function gerarPergunta() {
            // Gera 60% de Multiplica√ß√£o, 40% de Divis√£o
            const operacao = Math.random() < 0.6 ? 'multiplicacao' : 'divisao';
            let num1, num2, resultado;
            let sinal;

            if (operacao === 'multiplicacao') {
                num1 = getRandomInt(MIN_NUM, MAX_NUM);
                num2 = getRandomInt(MIN_NUM, MAX_NUM);
                resultado = num1 * num2;
                sinal = '√ó';
            } else { // Divis√£o
                resultado = getRandomInt(MIN_NUM, MAX_NUM);
                num2 = getRandomInt(MIN_NUM, MAX_NUM);
                num1 = resultado * num2;
                sinal = '√∑';
            }

            elPergunta.textContent = `${num1} ${sinal} ${num2} = ?`;
            respostaCorreta = resultado;
            gerarOpcoes(resultado);
        }

        function gerarOpcoes(respostaCerta) {
            const opcoes = new Set();
            opcoes.add(respostaCerta);

            while (opcoes.size < 4) {
                // Tenta gerar um erro na vizinhan√ßa
                let erro = respostaCerta + getRandomInt(-5, 5); 
                // Garante que o erro n√£o seja 0, nem igual e esteja dentro de um limite razo√°vel (1 a 81)
                if (erro > 0 && erro <= 81 && erro !== respostaCerta) {
                    opcoes.add(erro);
                }
            }

            const opcoesArray = misturarArray(Array.from(opcoes));
            
            elOpcoes.innerHTML = '';
            opcoesArray.forEach(opcao => {
                const btn = document.createElement('button');
                btn.className = 'opcao-btn';
                btn.textContent = opcao;
                btn.onclick = () => checarResposta(opcao);
                elOpcoes.appendChild(btn);
            });
        }

        function iniciarContadorTabuada() {
            tempoAtual = TEMPO_MAXIMO_TABUADA;
            elTempo.textContent = tempoAtual.toFixed(1);
            clearInterval(intervaloTempoTabuada);

            intervaloTempoTabuada = setInterval(() => {
                tempoAtual -= 0.1;
                elTempo.textContent = tempoAtual.toFixed(1);

                if (tempoAtual <= 0) {
                    pararContadorTabuada();
                    checarResposta(null); // Resposta nula: tempo esgotado
                }
            }, 100);
        }

        function pararContadorTabuada() {
            clearInterval(intervaloTempoTabuada);
        }

        function checarResposta(respostaDoJogador) {
            if (!jogoAtivo) return;

            pararContadorTabuada();
            Array.from(elOpcoes.children).forEach(btn => btn.disabled = true);


            if (respostaDoJogador === respostaCorreta) {
                // Acertou
                pontuacao++;
                acertosRodada++;
                elPontuacao.textContent = pontuacao;
                elAcertosRodada.textContent = acertosRodada;
                
                const msg = MENSAGENS_SUCESSO[getRandomInt(0, MENSAGENS_SUCESSO.length - 1)];
                exibirFeedback(msg, 'sucesso');
                
                if (acertosRodada === ACERTOS_PARA_BONUS) {
                    setTimeout(mostrarBonus, 1500);
                } else {
                    setTimeout(proximaRodada, 1500);
                }

            } else {
                // Errou ou o tempo esgotou (jogo continua!)
                
                // Mensagem aleat√≥ria de erro / tempo esgotado, mostrando a resposta correta
                let msgIndex = getRandomInt(0, MENSAGENS_ERRO.length - 1);
                let msg = MENSAGENS_ERRO[msgIndex] + respostaCorreta;

                if (respostaDoJogador === null) {
                    msg = "üò≠ Tempo Esgotado! A resposta correta era: " + respostaCorreta;
                }
                
                exibirFeedback(msg, 'erro');
                
                // Continua para a pr√≥xima rodada ap√≥s o feedback
                setTimeout(proximaRodada, 2000); 
            }
        }

        function proximaRodada() {
            elFeedback.textContent = '';
            Array.from(elOpcoes.children).forEach(btn => btn.disabled = false);
            gerarPergunta();
            iniciarContadorTabuada();
        }

        function iniciarJogo() {
            // Resetar o estado da rodada, mas manter a pontua√ß√£o
            pontuacao = 0;
            acertosRodada = 0;
            elPontuacao.textContent = pontuacao;
            elAcertosRodada.textContent = acertosRodada;

            jogoAtivo = true;
            elBotaoIniciar.textContent = 'Reiniciar Pontua√ß√£o';
            elBotaoIniciar.disabled = true;
            elBotaoIniciar.style.opacity = 0.5;

            // Garante que a tela da tabuada esteja ativa
            mostrarTabuada(false); 
            proximaRodada();
        }
        
        // --- L√≥gica do Jogo B√¥nus (Mem√≥ria) ---
        
        function gerarCartasMemoria() {
            const operacoes = [];
            while (operacoes.length < 8) {
                let num1, num2, resultado, operacaoStr;
                
                if (Math.random() < 0.7) { 
                    num1 = getRandomInt(2, 9);
                    num2 = getRandomInt(2, 9);
                    resultado = num1 * num2;
                    operacaoStr = `${num1} √ó ${num2}`;
                } else {
                    resultado = getRandomInt(2, 9);
                    num2 = getRandomInt(2, 9);
                    num1 = resultado * num2;
                    operacaoStr = `${num1} √∑ ${num2}`;
                }
                
                const par = { op: operacaoStr, res: resultado };
                // Adiciona verifica√ß√µes para evitar duplica√ß√£o
                if (!operacoes.some(p => p.op === par.op || p.res === par.res)) {
                    operacoes.push(par);
                }
            }
            
            let cartasData = [];
            operacoes.forEach((par, index) => {
                cartasData.push({ id: index, conteudo: par.op, tipo: 'op' });
                cartasData.push({ id: index, conteudo: par.res, tipo: 'res' });
            });

            return misturarArray(cartasData);
        }

        function renderizarCartas(cartas) {
            elMemoriaGrid.innerHTML = '';
            cartas.forEach(cartaData => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = cartaData.id;
                card.dataset.tipo = cartaData.tipo;
                card.onclick = () => virarCarta(card);
                
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-back">üï∑Ô∏è</div>
                        <div class="card-face card-front">${cartaData.conteudo}</div>
                    </div>
                `;
                elMemoriaGrid.appendChild(card);
            });
        }
        
        function virarCarta(card) {
            if (bloqueioCliques || card.classList.contains('flip') || card.classList.contains('matched')) return;
            
            card.classList.add('flip');
            cartasViradas.push(card);
            
            if (cartasViradas.length === 2) {
                bloqueioCliques = true;
                checarPar();
            }
        }
        
        function checarPar() {
            const [card1, card2] = cartasViradas;
            const id1 = card1.dataset.id;
            const id2 = card2.dataset.id;
            
            if (id1 === id2) {
                // Par encontrado (IDs correspondem)
                paresEncontrados++;
                elParesEncontrados.textContent = paresEncontrados;

                // Atraso para visualiza√ß√£o do match (1.5 segundos)
                setTimeout(() => {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    
                    if (paresEncontrados === 8) {
                        finalizarMemoria(true);
                    } else {
                        bloqueioCliques = false; // Libera cliques para a pr√≥xima
                    }
                }, 1500);

            } else {
                // N√£o √© um par
                setTimeout(() => {
                    card1.classList.remove('flip');
                    card2.classList.remove('flip');
                    bloqueioCliques = false; // Libera cliques
                }, 1000); // Vira de volta ap√≥s 1 segundo
            }
            
            cartasViradas = [];
        }

        function iniciarMemoria() {
            elContainerPrincipal.classList.add('bonus-mode');
            
            // Resetar estado do Jogo da Mem√≥ria
            paresEncontrados = 0;
            cartasViradas = [];
            bloqueioCliques = false;
            elParesEncontrados.textContent = '0';
            
            renderizarCartas(generarCartasMemoria());
        }

        function finalizarMemoria(vitoria) {
            // Resetar o contador de acertos para o b√¥nus, mas manter o score total!
            acertosRodada = 0;
            elAcertosRodada.textContent = acertosRodada;
            
            let mensagem = vitoria 
                ? "‚ú® Miss√£o B√¥nus COMPLETA! Voc√™ √© um MESTRE da Mem√≥ria!"
                : "Voltando para a Tabuada. Continue praticando para o pr√≥ximo b√¥nus!";
            
            alert(mensagem);

            // Voltar para o jogo principal
            mostrarTabuada(true);
        }
        
        // --- Controle de Fluxo (Alternar entre Jogos) ---
        
        function mostrarBonus() {
            jogoAtivo = false; // Pausa o jogo principal
            pararContadorTabuada();
            elJogoTabuada.style.display = 'none';
            elJogoBonus.style.display = 'block';
            elContainerPrincipal.classList.add('bonus-mode');
            elPergunta.textContent = "B√¥nus Desbloqueado!";
            
            iniciarMemoria();
        }
        
        function mostrarTabuada(retomar) {
            elJogoTabuada.style.display = 'block';
            elJogoBonus.style.display = 'none';
            elContainerPrincipal.classList.remove('bonus-mode');
            
            if(retomar) {
                 jogoAtivo = true; // Retoma o jogo principal
                 proximaRodada();
            } else {
                // Estado inicial
                 elBotaoIniciar.disabled = false;
                 elBotaoIniciar.style.opacity = 1;
            }
        }


        // Inicializa√ß√£o: Configura o estado inicial
        document.addEventListener('DOMContentLoaded', () => {
             elBotaoIniciar.onclick = iniciarJogo;
             elPergunta.textContent = "Clique em 'Iniciar Miss√£o' para come√ßar!";
        });
    </script>
</body>
</html>
